## Technical report for COSC 360 project: Epic News
In this document I will describe the technical aspects of the Epic news platform. This forum site was built on a software stack comprised of a Linux operating system, Apache web server, MySQL Database, and PHP (for the remainder of this document this stack will be referred to as the LAMP software stack). For testing in a local environment XAMPP control panel (version 3.3.0) while its production environment is on UBCO’s private server. The following sections will cover the following topics: the login page, the homepage, the create posts page, the post page, the user profile page, the admin page, other peripheral pages, and the supporting schemas.

The schemas were created with future flexibility in mind, with the following foreign keys:\
•	`Sub` is the schema for topics. It has an int `sub_id` for a primary key which is a foreign key for the table `post`.\
•	`Post` contains its sub information in a column called `sub_id`, it also contains information about who posted it, when, and whether it is visible to non-admins. It has a primary key of int `post_id` which is a foreign key in the table ‘comment’.\
•	`Comment` contains information about the user that posted it, when the comment was posted, and if it has a parent comment and thus is a reply. It has a primary key of `comment_id` which is also a foreign key to itself in the event of it being a sub-comment (or a reply).\
•	`User` has information on whether the user is an admin, contains their bio, profile picture and other relevant info surrounding their personal account. \
•	`Comment_votes` and `Posts_votes` are both lookup tables that allow the functionality of having one vote per user.\
•	`Post_img` houses the image data of any post as a BLOB.

These schemas are linked visually as follows:

![UML Diagram](/img/schema.png)

Moving along to the home page, there is a list of all posts that get requested from the server, initialized as an object, and then formatted for display via a component called `postComponent.php` in our files. Each post has a voting mechanism which will update the vote count of the post and well as links to the post author’s profile and their profile picture. The post on the home page auto refreshes every 10 seconds to include all updated information without refreshing the page and interrupting the user experience via the use of a file called `api.php`. This background page ensures that the right page receives the right update at a reasonable interval. The static sidebar, named `sidebarcomponent.php`, on the page contains quick nav links to the top and bottom of the page for the user’s convenience. The topics also get dynamically populated into the side bar, with each topic acting as a hyperlink for a new page that contains only that sub. As admins create more topics, that list in the sidebar will grow. On the top of the page is the header, `navbarComponent.php`, which contains the search bar, login/logout buttons, displays who is logged in as well as a link to the admin portal if the active user is an admin. For ease of development the `headerComponent.php` houses all the header information such as constants and include statements.

The admin page contains a broad overview of the entire website. The first panel contains a table which has all the posts on the website in an abbreviated form. Should the admin click any row in the table all relevant information from the table will populate into the panel beside it via the JavaScript embedded in that page. The table also creates links to the post for convenience. This will give the admin the ability to monitor a post as well as the option to ban or delete the post. The ban or delete page first checks for an admin status in the logged in user, then gives the option to either ban the post (making it disappear from user view but still findable in the admin page) or delete the post. There is also a search bar above the manage posts panel for faster results should the admin know what they are looking for. Similarly, the manage users panel has all the same features including a search bar for users, auto-populating details panel and links to ban or delete the user. Banning the user in this case also prevents them from logging into the website. Lastly at the bottom of this page there is the manage subs panel which has all relevant information for managing sub, including the ability to create new subs. When a new sub is created it is immediately included in both the side panel by the navigation links and the sub options in the drop-down menu in create post. At the bottom of the admin page there are usage statistics to monitor site usage.

The `createPostPage.php` is kept simplistic with the dropdown menu for sub-topics mentioned before, a text panel for the post title and one more for post content. Additionally, the user can add one or more images to their post if they want. On submit button click the contents get checked for null values, and should it contain none, it creates a new post via a function in the `Post.php` object that adds the user id from the author and the current timestamp. That post then is added to the top of the home page (and its relevant sub-topic page), where everyone can see it. Once that post is clicked on, from either of those two pages, the user will be directed to the post content page (`postContentPage.php`). In the post content page any signed in, active user can post a comment, reply to a comment, or vote on either the post itself or any comment on the page. Each object on the page has both its own class, housing its variable and methods, and components, housing all its user interface styling. Each comment has the ability to be replied to, once reply is clicked it redirects the user to a page where they enter text and create a sub-comment. They will then be re-directed to the `PostContentPage.php` from whence they came with their comment present.

There is also the login page which contains both the ability to login and the ability to register. While both options are handled on one page, the submit redirects to two separate places. Should a new user enter information to register, they must provide a password of adequate length and complexity, containing a mixture of number and letters. The password requirements will be displayed upon invalid submission. Once the requirements to register into the web site are met, their passwords get encrypted, their information gets saved to the database, and then they will then be able to sign in and navigate around the website. The login function acts in a way to reduce errors and dependencies to check for valid entries in username and password, then determines if the user is banned, then logs the user in and sets all relevant session variables such as username, user_id and is_admin. 

Each user gets their own profile page which contains a place for a file upload so they can customize their profile picture as well as edit an “about me” section that will be visible to all users. They also have a ‘Karma’ score which indicates the sum of the votes on their content. The user may also change their email address there. On this page, admins can ban the user and if the active user_id is matches the user_id of the profile getting viewed then they can edit the information on that page. This page also displays posts made by that user.

Additionally, there are a few small pages to clean up the main user flow and keep only relevant UI components in view. Through the admin portal the ban page can be accessed to delete the requested post, user, or topic. This one page manages those three options distinctly as it evaluates whether the user logged in is an admin before displaying anything to prevent users from trespassing into it via the URL. The admin page sends the query to `BanPage.php` and renders accordingly, providing detailed information and context around what is on the chopping block. Should the ‘ban’ option be selected, this option will be removed from regular user view, while the delete option removes it entirely. There are also three filtered search result pages: Topic, user search results, and title search result. While the Topic page is accessed through the side bar, the two searches provide a case insensitive query to speed up the traversal from point A to point B for a user. There are also two small support pages surrounding the login functions. Should you forget your password, the prompt on the login page will take you to a simple page where an email will be entered to receive a new password. Once the email is validated a reset link will be sent to the requested email with a link to a resetPage.php that will prompt the user for a new secure password. The reset password functionality is implemented with the PHPMailer library to construct and send the email.

There are small tweaks that could be made in the future. Right now a lot of functionality rests in the hands of admins, where in the future development cycles more features could be opened up to users (such as creating sub topics) once more protections are in place. Furthermore the is room for improvement in preventing the ability for cross-site scripting attacks for user information that gets rendered onto the site. This concludes the technical report for the Epic News project, and I hope you enjoy exploring our website!
 
